<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>海事局VTS值班人事管理系统</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FullCalendar -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.min.css">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
    
    <style>
        /* 基础样式优化 */
        html, body {
            scroll-behavior: smooth;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal.show {
            display: flex;
        }
        .page {
            display: none;
            min-height: 100vh;
            width: 100%;
        }
        .page.active {
            display: block;
        }
        
        /* 登录页面居中修复 */
        #loginPage, #registerPage {
            display: none;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
            box-sizing: border-box;
        }
        #loginPage.active, #registerPage.active {
            display: flex !important;
        }
        
        /* 头部固定优化 */
        .main-header {
            position: sticky;
            top: 0;
            z-index: 20;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* 主内容区域 - 移除多余的padding */
        .main-content {
            padding-top: 0;
            min-height: calc(100vh - 200px);
        }
        
        /* 可访问性增强 */
        a:focus-visible, 
        button:focus-visible, 
        select:focus-visible, 
        input:focus-visible, 
        textarea:focus-visible {
            outline: 3px solid #2563eb;
            outline-offset: 2px;
            border-radius: .375rem;
        }
        
        /* 加载动画 */
        .loading {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 表格斑马纹 */
        .table-striped tbody tr:nth-child(even) {
            background-color: #f8fafc;
        }
        
        /* 页面切换动画 */
        .page-transition {
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        
        .page.active .page-transition {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* 统计卡片优化 */
        .stat-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        /* 响应式优化 */
        @media (max-width: 768px) {
            .responsive-table {
                font-size: 0.875rem;
            }
            .responsive-table th,
            .responsive-table td {
                padding: 0.5rem 0.25rem;
            }
            
            .main-content {
                padding: 0.5rem;
            }
            
            .stat-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }
        }
        
        @media (max-width: 640px) {
            .stat-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    
    <!-- 登录页面 -->
    <div id="loginPage" class="page active min-h-screen flex items-center justify-center">
        <div class="page-transition max-w-md w-full mx-4">
            <div class="bg-white rounded-lg shadow-xl p-8">
                <div class="text-center mb-8">
                    <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.031 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-900">海事局VTS系统</h1>
                    <p class="text-gray-600 mt-2">请登录您的账号</p>
                </div>
                
                <form id="loginForm" class="space-y-6" role="form" aria-labelledby="loginTitle">
                    <div>
                        <label for="loginUsername" class="block text-sm font-medium text-gray-700 mb-2">用户名</label>
                        <input type="text" id="loginUsername" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               aria-describedby="loginUsernameHelp">
                    </div>
                    
                    <div>
                        <label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-2">密码</label>
                        <input type="password" id="loginPassword" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label for="loginOrganization" class="block text-sm font-medium text-gray-700 mb-2">单位</label>
                        <select id="loginOrganization" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">请选择单位</option>
                            <option value="省厅">山东海事局</option>
                            <option value="烟台分局">烟台海事局</option>
                            <option value="青岛分局">青岛海事局</option>
                            <option value="威海分局">威海海事局</option>
                            <option value="日照分局">日照海事局</option>
                            <option value="东营分局">东营海事局</option>
                            <option value="潍坊分局">潍坊海事局</option>
                            <option value="董家口分局">董家口海事局</option>
                            <option value="滨州分局">滨州海事局</option>
                        </select>
                    </div>
                    
                    <button type="submit" 
                            class="w-full bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-200 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                        登录
                    </button>
                </form>
                
                <div class="mt-6 text-center">
                    <button onclick="showRegisterForm()" 
                            class="text-blue-600 hover:text-blue-800 text-sm focus:outline-none focus:underline">
                        还没有账号？点击注册
                    </button>
                </div>
                
                <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                    <h4 class="font-medium text-blue-900 mb-2">测试账号</h4>
                    <div class="text-sm text-blue-800 space-y-1">
                        <div><strong>管理员:</strong> admin / 123456</div>
                        <div><strong>普通用户:</strong> user / 123456</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 注册页面 -->
    <div id="registerPage" class="page min-h-screen flex items-center justify-center">
        <div class="page-transition max-w-md w-full mx-4">
            <div class="bg-white rounded-lg shadow-xl p-8">
                <div class="text-center mb-8">
                    <div class="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-900">用户注册</h1>
                    <p class="text-gray-600 mt-2">创建您的账号</p>
                </div>
                
                <form id="registerForm" class="space-y-4" role="form">
                    <div>
                        <label for="regUsername" class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
                        <input type="text" id="regUsername" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label for="regPassword" class="block text-sm font-medium text-gray-700 mb-1">密码</label>
                        <input type="password" id="regPassword" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label for="regPasswordConfirm" class="block text-sm font-medium text-gray-700 mb-1">确认密码</label>
                        <input type="password" id="regPasswordConfirm" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label for="regRealName" class="block text-sm font-medium text-gray-700 mb-1">真实姓名</label>
                        <input type="text" id="regRealName" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label for="regOrganization" class="block text-sm font-medium text-gray-700 mb-1">所属单位</label>
                        <select id="regOrganization" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">请选择单位</option>
                            <option value="省厅">山东海事局</option>
                            <option value="烟台分局">烟台海事局</option>
                            <option value="青岛分局">青岛海事局</option>
                            <option value="威海分局">威海海事局</option>
                            <option value="日照分局">日照海事局</option>
                            <option value="东营分局">东营海事局</option>
                            <option value="潍坊分局">潍坊海事局</option>
                            <option value="董家口分局">董家口海事局</option>
                            <option value="滨州分局">滨州海事局</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="regUserType" class="block text-sm font-medium text-gray-700 mb-1">用户类型</label>
                        <select id="regUserType" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="user">普通用户</option>
                            <option value="admin">管理员</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-1">管理员需要上级审核批准</p>
                    </div>
                    
                    <button type="submit" 
                            class="w-full bg-green-600 hover:bg-green-700 focus:ring-4 focus:ring-green-200 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                        注册
                    </button>
                </form>
                
                <div class="mt-6 text-center">
                    <button onclick="showLoginForm()" 
                            class="text-blue-600 hover:text-blue-800 text-sm focus:outline-none focus:underline">
                        已有账号？返回登录
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 主系统页面 -->
    <div id="mainPage" class="page">
        <div class="page-transition">
            <!-- 头部导航 -->
            <div class="main-header bg-blue-900 text-white p-4 md:p-6">
                <div class="max-w-7xl mx-auto flex flex-wrap justify-between items-center">
                    <div class="mb-2 sm:mb-0">
                        <h1 class="text-xl sm:text-2xl md:text-3xl font-bold mb-2">海事局VTS值班人事管理系统</h1>
                        <p class="text-blue-100 text-sm md:text-base">Maritime Safety Administration VTS Human Resource Management System</p>
                    </div>
                    <div class="flex items-center space-x-2 sm:space-x-4">
                        <div class="text-right">
                            <div class="font-medium text-sm md:text-base" id="currentUserName">未登录</div>
                            <div class="text-xs md:text-sm text-blue-200" id="currentUserOrg">-</div>
                            <div class="text-xs text-blue-300" id="currentUserRole">-</div>
                        </div>
                        <button onclick="showUserManagement()" id="userManagementBtn" 
                                class="hidden bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-200 px-3 py-2 rounded-lg text-xs md:text-sm transition-colors">
                            用户管理
                        </button>
                        <button onclick="logout()" 
                                class="bg-red-600 hover:bg-red-700 focus:ring-4 focus:ring-red-200 px-3 py-2 rounded-lg text-xs md:text-sm transition-colors">
                            退出登录
                        </button>
                    </div>
                </div>
            </div>

            <div class="main-content max-w-7xl mx-auto p-2 md:p-4">
                <!-- 统计卡片 -->
                <div class="stat-grid grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 md:gap-6 mb-4 md:mb-6">
                    <div class="stat-card bg-white rounded-lg shadow p-3 md:p-6 hover:shadow-md transition-shadow">
                        <div class="flex items-center">
                            <svg class="h-6 w-6 md:h-8 md:w-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                            <div class="ml-2 md:ml-4">
                                <p class="text-xs md:text-sm font-medium text-gray-600">总人数</p>
                                <p class="text-lg md:text-2xl font-semibold text-gray-900" id="totalCount">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card bg-white rounded-lg shadow p-3 md:p-6 hover:shadow-md transition-shadow">
                        <div class="flex items-center">
                            <svg class="h-6 w-6 md:h-8 md:w-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <div class="ml-2 md:ml-4">
                                <p class="text-xs md:text-sm font-medium text-gray-600">在岗人员</p>
                                <p class="text-lg md:text-2xl font-semibold text-gray-900" id="onDutyCount">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card bg-white rounded-lg shadow p-3 md:p-6 hover:shadow-md transition-shadow">
                        <div class="flex items-center">
                            <svg class="h-6 w-6 md:h-8 md:w-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                            </svg>
                            <div class="ml-2 md:ml-4">
                                <p class="text-xs md:text-sm font-medium text-gray-600">值班长</p>
                                <p class="text-lg md:text-2xl font-semibold text-gray-900" id="supervisorCount">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card bg-white rounded-lg shadow p-3 md:p-6 hover:shadow-md transition-shadow">
                        <div class="flex items-center">
                            <svg class="h-6 w-6 md:h-8 md:w-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"></path>
                            </svg>
                            <div class="ml-2 md:ml-4">
                                <p class="text-xs md:text-sm font-medium text-gray-600">持证人员</p>
                                <p class="text-lg md:text-2xl font-semibold text-gray-900" id="certifiedCount">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card bg-white rounded-lg shadow p-3 md:p-6 hover:shadow-md transition-shadow col-span-2 sm:col-span-1">
                        <div class="flex items-center">
                            <svg class="h-6 w-6 md:h-8 md:w-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <div class="ml-2 md:ml-4">
                                <p class="text-xs md:text-sm font-medium text-gray-600">本月值班</p>
                                <p class="text-lg md:text-2xl font-semibold text-gray-900" id="monthlyDutyHours">0</p>
                                <p class="text-xs text-gray-500">小时</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 搜索和筛选区域 -->
                <div class="bg-white rounded-lg shadow p-4 md:p-6 mb-4 md:mb-6">
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4 mb-4">
                        <div class="relative lg:col-span-2">
                            <input type="text" id="searchInput" 
                                   placeholder="搜索姓名、工号、单位..."
                                   class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   aria-label="搜索员工信息">
                            <svg class="absolute left-3 top-2.5 h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>
                        
                        <select id="unitFilter" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">所有单位</option>
                        </select>
                        
                        <select id="roleFilter" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">所有身份</option>
                            <option value="值班长">值班长</option>
                            <option value="值班员">值班员</option>
                            <option value="协管">协管</option>
                            <option value="实习">实习</option>
                        </select>
                        
                        <select id="onDutyFilter" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">在岗情况</option>
                            <option value="有">在岗</option>
                            <option value="无">不在岗</option>
                        </select>
                        
                        <select id="dutyTimeFilter" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">值班时间</option>
                            <option value="0-50">0-50小时</option>
                            <option value="51-100">51-100小时</option>
                            <option value="101-150">101-150小时</option>
                            <option value="151+">151小时以上</option>
                        </select>
                        
                        <select id="certificateFilter" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">证书情况</option>
                            <option value="有证书">有证书</option>
                            <option value="无证书">无证书</option>
                            <option value="船长">船长</option>
                            <option value="大副">大副</option>
                            <option value="二副">二副</option>
                            <option value="三副">三副</option>
                            <option value="轮机长">轮机长</option>
                            <option value="大管轮">大管轮</option>
                            <option value="二管轮">二管轮</option>
                            <option value="电机员">电机员</option>
                        </select>
                        
                        <select id="educationFilter" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">所有学历</option>
                            <option value="大专">大专</option>
                            <option value="本科">本科</option>
                            <option value="研究生及以上">研究生及以上</option>
                        </select>
                        
                        <button onclick="showAddModal()" id="addEmployeeBtn" 
                                class="bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-200 text-white px-4 py-2 rounded-lg hidden transition-colors">
                            添加员工
                        </button>
                    </div>
                    
                    <div class="flex flex-wrap justify-between items-center gap-4">
                        <div class="flex flex-wrap gap-2">
                            <button onclick="exportToCSV()" 
                                    class="bg-green-600 hover:bg-green-700 focus:ring-4 focus:ring-green-200 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                导出CSV
                            </button>
                            <button onclick="showDutySchedule()" 
                                    class="bg-indigo-600 hover:bg-indigo-700 focus:ring-4 focus:ring-indigo-200 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                值班日历
                            </button>
                            <button onclick="showDutyAnalysis()" 
                                    class="bg-purple-600 hover:bg-purple-700 focus:ring-4 focus:ring-purple-200 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                                值班分析
                            </button>
                        </div>

                        <div class="flex flex-wrap gap-2">
                            <button onclick="showBulkActions()" id="bulkActionsBtn" 
                                    class="bg-orange-600 hover:bg-orange-700 focus:ring-4 focus:ring-orange-200 text-white px-4 py-2 rounded-lg text-sm hidden transition-colors">
                                批量操作
                            </button>
                            <button onclick="resetToDefaultData()" id="resetDataBtn" 
                                    class="bg-red-600 hover:bg-red-700 focus:ring-4 focus:ring-red-200 text-white px-4 py-2 rounded-lg text-sm hidden transition-colors">
                                重置数据
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 员工列表 -->
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 responsive-table table-striped">
                            <caption class="sr-only">VTS员工信息列表</caption>
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        <input type="checkbox" id="selectAll" onchange="toggleSelectAll()" 
                                               class="mr-2" aria-label="全选员工">
                                        员工信息
                                    </th>
                                    <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">单位职务</th>
                                    <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">在岗状态</th>
                                    <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">值班时间</th>
                                    <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">证书情况</th>
                                    <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">联系方式</th>
                                    <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                </tr>
                            </thead>
                            <tbody id="employeeTable" class="bg-white divide-y divide-gray-200">
                                <!-- 员工数据将由JavaScript动态生成 -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- 分页控件 -->
                    <div id="paginationContainer" class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6">
                        <div class="flex-1 flex justify-between sm:hidden">
                            <button id="prevPageMobile" 
                                    class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50">
                                上一页
                            </button>
                            <button id="nextPageMobile" 
                                    class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50">
                                下一页
                            </button>
                        </div>
                        <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                            <div>
                                <p class="text-sm text-gray-700">
                                    显示第 <span id="startItem" class="font-medium">1</span> 到 
                                    <span id="endItem" class="font-medium">10</span> 条，
                                    共 <span id="totalItems" class="font-medium">0</span> 条记录
                                </p>
                            </div>
                            <div>
                                <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="分页">
                                    <button id="prevPage" 
                                            class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50">
                                        <span class="sr-only">上一页</span>
                                        <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                        </svg>
                                    </button>
                                    
                                    <div id="pageNumbers" class="flex">
                                        <!-- 页码按钮将由JavaScript生成 -->
                                    </div>
                                    
                                    <button id="nextPage" 
                                            class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50">
                                        <span class="sr-only">下一页</span>
                                        <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                                        </svg>
                                    </button>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 值班日历区域 -->
                <div id="calendarSection" class="mt-8 bg-white rounded-lg shadow p-6 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-900">值班日历安排</h3>
                        <button onclick="hideCalendar()" 
                                class="text-gray-400 hover:text-gray-600 focus:outline-none">
                            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="calendar"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 用户管理页面 -->
    <div id="userManagementPage" class="page">
        <div class="page-transition">
            <div class="bg-blue-900 text-white p-6">
                <div class="max-w-7xl mx-auto flex justify-between items-center">
                    <div>
                        <h1 class="text-3xl font-bold mb-2">用户管理</h1>
                        <p class="text-blue-100">User Management System</p>
                    </div>
                    <button onclick="backToMain()" 
                            class="bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-200 px-4 py-2 rounded-lg transition-colors">
                        返回主页
                    </button>
                </div>
            </div>

            <div class="max-w-7xl mx-auto p-6">
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">系统用户列表</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <caption class="sr-only">系统用户管理表</caption>
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">用户名</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">真实姓名</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">所属单位</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">用户类型</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">状态</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">注册时间</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                </tr>
                            </thead>
                            <tbody id="userTable" class="bg-white divide-y divide-gray-200">
                                <!-- 用户数据将由JavaScript动态生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 以下模态框保持原样，但添加page-transition类 -->
    <!-- 添加员工模态框 -->
    <div id="addModal" class="modal fixed inset-0 z-50 overflow-y-auto" role="dialog" aria-modal="true" aria-labelledby="addModalTitle">
        <div class="flex items-center justify-center min-h-screen px-4 py-8">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" onclick="hideAddModal()" aria-hidden="true"></div>
            
            <div class="relative bg-white rounded-lg shadow-xl max-w-4xl w-full mx-auto z-10 max-h-screen overflow-y-auto">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 id="addModalTitle" class="text-lg font-medium text-gray-900">添加新员工</h3>
                </div>
                
                <form id="addEmployeeForm" class="px-6 py-4 space-y-6">
                    <!-- 基本信息 -->
                    <div class="border-b pb-4">
                        <h4 class="text-md font-medium text-gray-700 mb-3">基本信息</h4>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <div>
                                <label for="newName" class="block text-sm font-medium text-gray-700 mb-1">姓名 *</label>
                                <input type="text" id="newName" required
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div>
                                <label for="newEmpId" class="block text-sm font-medium text-gray-700 mb-1">工号 *</label>
                                <input type="text" id="newEmpId" required
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div>
                                <label for="newGender" class="block text-sm font-medium text-gray-700 mb-1">性别</label>
                                <select id="newGender" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="男">男</option>
                                    <option value="女">女</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4">
                            <div>
                                <label for="newBirthDate" class="block text-sm font-medium text-gray-700 mb-1">出生日期</label>
                                <input type="date" id="newBirthDate" onchange="calculateAge('new')"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div>
                                <label for="newAge" class="block text-sm font-medium text-gray-700 mb-1">年龄</label>
                                <input type="number" id="newAge" readonly
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-600">
                            </div>
                            <div>
                                <label for="newEducation" class="block text-sm font-medium text-gray-700 mb-1">学历</label>
                                <select id="newEducation" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="大专">大专</option>
                                    <option value="本科">本科</option>
                                    <option value="研究生及以上">研究生及以上</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                            <div>
                                <label for="newSalary" class="block text-sm font-medium text-gray-700 mb-1">薪资</label>
                                <input type="number" id="newSalary" min="0" step="100"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                        </div>
                    </div>

                    <!-- 工作信息 -->
                    <div class="border-b pb-4">
                        <h4 class="text-md font-medium text-gray-700 mb-3">工作信息</h4>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="newUnit" class="block text-sm font-medium text-gray-700 mb-1">单位</label>
                                <input type="text" id="newUnit" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div>
                                <label for="newRole" class="block text-sm font-medium text-gray-700 mb-1">身份</label>
                                <select id="newRole" onchange="handleRoleChange('new')"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="值班长">值班长</option>
                                    <option value="值班员">值班员</option>
                                    <option value="协管">协管</option>
                                    <option value="实习">实习</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                            <div>
                                <label for="newOnDuty" class="block text-sm font-medium text-gray-700 mb-1">在岗情况</label>
                                <select id="newOnDuty" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="有">有</option>
                                    <option value="无">无</option>
                                </select>
                            </div>
                            <div>
                                <label for="newDutyTime" class="block text-sm font-medium text-gray-700 mb-1">值班时间</label>
                                <select id="newDutyTime" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="白班">白班 (08:00-16:00)</option>
                                    <option value="夜班">夜班 (16:00-24:00)</option>
                                    <option value="深夜班">深夜班 (00:00-08:00)</option>
                                    <option value="全天">全天值班</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- 证书信息 -->
                    <div class="border-b pb-4">
                        <h4 class="text-md font-medium text-gray-700 mb-3">证书信息</h4>
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                            <div class="flex items-center">
                                <input type="checkbox" id="newCertCaptain" class="mr-2">
                                <label for="newCertCaptain" class="text-sm text-gray-700">船长</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="newCertChiefOfficer" class="mr-2">
                                <label for="newCertChiefOfficer" class="text-sm text-gray-700">大副</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="newCertSecondOfficer" class="mr-2">
                                <label for="newCertSecondOfficer" class="text-sm text-gray-700">二副</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="newCertThirdOfficer" class="mr-2">
                                <label for="newCertThirdOfficer" class="text-sm text-gray-700">三副</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="newCertChiefEngineer" class="mr-2">
                                <label for="newCertChiefEngineer" class="text-sm text-gray-700">轮机长</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="newCertFirstEngineer" class="mr-2">
                                <label for="newCertFirstEngineer" class="text-sm text-gray-700">大管轮</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="newCertSecondEngineer" class="mr-2">
                                <label for="newCertSecondEngineer" class="text-sm text-gray-700">二管轮</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="newCertElectrician" class="mr-2">
                                <label for="newCertElectrician" class="text-sm text-gray-700">电机员</label>
                            </div>
                        </div>
                    </div>

                    <!-- 联系信息 -->
                    <div>
                        <h4 class="text-md font-medium text-gray-700 mb-3">联系信息</h4>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="newPhone" class="block text-sm font-medium text-gray-700 mb-1">电话</label>
                                <input type="tel" id="newPhone" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div>
                                <label for="newEmail" class="block text-sm font-medium text-gray-700 mb-1">邮箱</label>
                                <input type="email" id="newEmail" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <label for="newRemark" class="block text-sm font-medium text-gray-700 mb-1">备注</label>
                            <textarea id="newRemark" rows="3" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                        </div>
                    </div>
                </form>
                
                <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                    <button type="button" onclick="hideAddModal()" 
                            class="px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 focus:ring-4 focus:ring-gray-200 rounded-lg transition-colors">
                        取消
                    </button>
                    <button type="button" onclick="addEmployee()" 
                            class="px-4 py-2 bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-200 text-white rounded-lg transition-colors">
                        保存
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 查看详情模态框 -->
    <div id="viewModal" class="modal fixed inset-0 z-50 overflow-y-auto" role="dialog" aria-modal="true" aria-labelledby="viewModalTitle">
        <div class="flex items-center justify-center min-h-screen px-4 py-8">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" onclick="hideViewModal()" aria-hidden="true"></div>
            
            <div class="relative bg-white rounded-lg shadow-xl max-w-4xl w-full mx-auto z-10">
                <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                    <h3 id="viewModalTitle" class="text-lg font-medium text-gray-900">员工详细信息</h3>
                    <button onclick="hideViewModal()" 
                            class="text-gray-400 hover:text-gray-600 focus:outline-none">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="px-6 py-6 max-h-96 overflow-y-auto" id="employeeDetails">
                    <!-- 员工详情将由JavaScript动态填充 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 编辑员工模态框 -->
    <div id="editModal" class="modal fixed inset-0 z-50 overflow-y-auto" role="dialog" aria-modal="true" aria-labelledby="editModalTitle">
        <div class="flex items-center justify-center min-h-screen px-4 py-8">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" onclick="hideEditModal()" aria-hidden="true"></div>
            
            <div class="relative bg-white rounded-lg shadow-xl max-w-4xl w-full mx-auto z-10 max-h-screen overflow-y-auto">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 id="editModalTitle" class="text-lg font-medium text-gray-900">编辑员工信息</h3>
                </div>
                
                <form id="editEmployeeForm" class="px-6 py-4 space-y-6">
                    <!-- 编辑表单内容与添加表单类似，但使用edit前缀的ID -->
                    <!-- 基本信息 -->
                    <div class="border-b pb-4">
                        <h4 class="text-md font-medium text-gray-700 mb-3">基本信息</h4>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <div>
                                <label for="editName" class="block text-sm font-medium text-gray-700 mb-1">姓名 *</label>
                                <input type="text" id="editName" required
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div>
                                <label for="editEmpId" class="block text-sm font-medium text-gray-700 mb-1">工号 *</label>
                                <input type="text" id="editEmpId" required
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div>
                                <label for="editGender" class="block text-sm font-medium text-gray-700 mb-1">性别</label>
                                <select id="editGender" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="男">男</option>
                                    <option value="女">女</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4">
                            <div>
                                <label for="editBirthDate" class="block text-sm font-medium text-gray-700 mb-1">出生日期</label>
                                <input type="date" id="editBirthDate" onchange="calculateAge('edit')"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div>
                                <label for="editAge" class="block text-sm font-medium text-gray-700 mb-1">年龄</label>
                                <input type="number" id="editAge" readonly
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-600">
                            </div>
                            <div>
                                <label for="editEducation" class="block text-sm font-medium text-gray-700 mb-1">学历</label>
                                <select id="editEducation" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="大专">大专</option>
                                    <option value="本科">本科</option>
                                    <option value="研究生及以上">研究生及以上</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                            <div>
                                <label for="editSalary" class="block text-sm font-medium text-gray-700 mb-1">薪资</label>
                                <input type="number" id="editSalary" min="0" step="100"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                        </div>
                    </div>

                    <!-- 工作信息 -->
                    <div class="border-b pb-4">
                        <h4 class="text-md font-medium text-gray-700 mb-3">工作信息</h4>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="editUnit" class="block text-sm font-medium text-gray-700 mb-1">单位</label>
                                <input type="text" id="editUnit" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div>
                                <label for="editRole" class="block text-sm font-medium text-gray-700 mb-1">身份</label>
                                <select id="editRole" onchange="handleRoleChange('edit')"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="值班长">值班长</option>
                                    <option value="值班员">值班员</option>
                                    <option value="协管">协管</option>
                                    <option value="实习">实习</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                            <div>
                                <label for="editOnDuty" class="block text-sm font-medium text-gray-700 mb-1">在岗情况</label>
                                <select id="editOnDuty" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="有">有</option>
                                    <option value="无">无</option>
                                </select>
                            </div>
                            <div>
                                <label for="editDutyTime" class="block text-sm font-medium text-gray-700 mb-1">值班时间</label>
                                <select id="editDutyTime" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="白班">白班 (08:00-16:00)</option>
                                    <option value="夜班">夜班 (16:00-24:00)</option>
                                    <option value="深夜班">深夜班 (00:00-08:00)</option>
                                    <option value="全天">全天值班</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- 证书信息 -->
                    <div class="border-b pb-4">
                        <h4 class="text-md font-medium text-gray-700 mb-3">证书信息</h4>
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                            <div class="flex items-center">
                                <input type="checkbox" id="editCertCaptain" class="mr-2">
                                <label for="editCertCaptain" class="text-sm text-gray-700">船长</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="editCertChiefOfficer" class="mr-2">
                                <label for="editCertChiefOfficer" class="text-sm text-gray-700">大副</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="editCertSecondOfficer" class="mr-2">
                                <label for="editCertSecondOfficer" class="text-sm text-gray-700">二副</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="editCertThirdOfficer" class="mr-2">
                                <label for="editCertThirdOfficer" class="text-sm text-gray-700">三副</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="editCertChiefEngineer" class="mr-2">
                                <label for="editCertChiefEngineer" class="text-sm text-gray-700">轮机长</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="editCertFirstEngineer" class="mr-2">
                                <label for="editCertFirstEngineer" class="text-sm text-gray-700">大管轮</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="editCertSecondEngineer" class="mr-2">
                                <label for="editCertSecondEngineer" class="text-sm text-gray-700">二管轮</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="editCertElectrician" class="mr-2">
                                <label for="editCertElectrician" class="text-sm text-gray-700">电机员</label>
                            </div>
                        </div>
                    </div>

                    <!-- 联系信息 -->
                    <div>
                        <h4 class="text-md font-medium text-gray-700 mb-3">联系信息</h4>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="editPhone" class="block text-sm font-medium text-gray-700 mb-1">电话</label>
                                <input type="tel" id="editPhone" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div>
                                <label for="editEmail" class="block text-sm font-medium text-gray-700 mb-1">邮箱</label>
                                <input type="email" id="editEmail" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <label for="editRemark" class="block text-sm font-medium text-gray-700 mb-1">备注</label>
                            <textarea id="editRemark" rows="3" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                        </div>
                    </div>
                </form>
                
                <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                    <button type="button" onclick="hideEditModal()" 
                            class="px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 focus:ring-4 focus:ring-gray-200 rounded-lg transition-colors">
                        取消
                    </button>
                    <button type="button" onclick="saveEditEmployee()" 
                            class="px-4 py-2 bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-200 text-white rounded-lg transition-colors">
                        保存
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 值班历史模态框 -->
    <div id="dutyHistoryModal" class="modal fixed inset-0 z-50 overflow-y-auto" role="dialog" aria-modal="true" aria-labelledby="dutyHistoryModalTitle">
        <div class="flex items-center justify-center min-h-screen px-4 py-8">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" onclick="hideDutyHistoryModal()" aria-hidden="true"></div>
            
            <div class="relative bg-white rounded-lg shadow-xl max-w-4xl w-full mx-auto z-10">
                <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                    <h3 id="dutyHistoryModalTitle" class="text-lg font-medium text-gray-900">值班历史管理</h3>
                    <button onclick="hideDutyHistoryModal()" 
                            class="text-gray-400 hover:text-gray-600 focus:outline-none">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="px-6 py-6 max-h-96 overflow-y-auto" id="dutyHistoryContent">
                    <!-- 值班历史内容将由JavaScript动态填充 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 批量操作模态框 -->
    <div id="bulkModal" class="modal fixed inset-0 z-50 overflow-y-auto" role="dialog" aria-modal="true" aria-labelledby="bulkModalTitle">
        <div class="flex items-center justify-center min-h-screen px-4 py-8">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" onclick="hideBulkModal()" aria-hidden="true"></div>
            
            <div class="relative bg-white rounded-lg shadow-xl max-w-2xl w-full mx-auto z-10">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 id="bulkModalTitle" class="text-lg font-medium text-gray-900">批量操作 (<span id="selectedCount">0</span> 人已选择)</h3>
                </div>
                
                <div class="px-6 py-4 space-y-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <button onclick="bulkDelete()" 
                                class="bg-red-600 hover:bg-red-700 focus:ring-4 focus:ring-red-200 text-white px-4 py-2 rounded-lg transition-colors">
                            批量删除
                        </button>
                        <button onclick="bulkChangeStatus()" 
                                class="bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-200 text-white px-4 py-2 rounded-lg transition-colors">
                            批量修改在岗状态
                        </button>
                        <button onclick="bulkExport()" 
                                class="bg-green-600 hover:bg-green-700 focus:ring-4 focus:ring-green-200 text-white px-4 py-2 rounded-lg transition-colors">
                            导出选中员工
                        </button>
                        <button onclick="addDutyRecord()" 
                                class="bg-purple-600 hover:bg-purple-700 focus:ring-4 focus:ring-purple-200 text-white px-4 py-2 rounded-lg transition-colors">
                            添加值班记录
                        </button>
                    </div>
                </div>
                
                <div class="px-6 py-4 border-t border-gray-200 flex justify-end">
                    <button onclick="hideBulkModal()" 
                            class="px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 focus:ring-4 focus:ring-gray-200 rounded-lg transition-colors">
                        取消
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 值班分析模态框 -->
    <div id="analysisModal" class="modal fixed inset-0 z-50 overflow-y-auto" role="dialog" aria-modal="true" aria-labelledby="analysisModalTitle">
        <div class="flex items-center justify-center min-h-screen px-4 py-8">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" onclick="hideAnalysisModal()" aria-hidden="true"></div>
            
            <div class="relative bg-white rounded-lg shadow-xl max-w-6xl w-full mx-auto z-10 max-h-screen overflow-y-auto">
                <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                    <h3 id="analysisModalTitle" class="text-lg font-medium text-gray-900">值班分析报告</h3>
                    <button onclick="hideAnalysisModal()" 
                            class="text-gray-400 hover:text-gray-600 focus:outline-none">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="px-6 py-6" id="analysisContent">
                    <!-- 分析内容将由JavaScript动态填充 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 加载提示 -->
    <div id="loadingIndicator" class="fixed bottom-4 right-4 bg-white rounded-lg shadow-lg p-4 hidden z-50">
        <div class="flex items-center space-x-3">
            <div class="loading"></div>
            <span class="text-gray-600">正在处理...</span>
        </div>
    </div>

    <script>
        /*********************
         * 全局变量与用户系统
         *********************/
        let currentUser = null;
        let users = [
            {
                id: 1,
                username: 'admin',
                password: '123456',
                realName: '系统管理员',
                organization: '省厅',
                userType: 'admin',
                status: 'active',
                registeredAt: '2024-01-01'
            },
            {
                id: 2,
                username: 'user',
                password: '123456',
                realName: '张三',
                organization: '青岛分局',
                userType: 'user',
                status: 'active',
                registeredAt: '2024-01-02'
            }
        ];

        // 员工数据按单位分组
        let employeesByOrganization = {
            '省厅': [
                {
                    id: 1, name: '王局长', employeeId: 'SD001', gender: '男', birthDate: '1976-03-15',
                    unit: '山东海事局VTS中心', role: '值班长', onDuty: '有', dutyTime: '全天',
                    phone: '13800001111', email: 'wang@sd.vts.msa.gov.cn',
                    certificates: ['船长', '大副'], education: '研究生及以上', 
                    salary: 12000,
                    dutyHistory: ['2024-01-15', '2024-01-20', '2024-02-01', '2024-02-15'],
                    dutyHours: 120, remark: '山东海事局资深管理人员'
                },
                {
                    id: 2, name: '李副局长', employeeId: 'SD002', gender: '男', birthDate: '1979-06-20',
                    unit: '山东海事局VTS中心', role: '值班长', onDuty: '有', dutyTime: '白班',
                    phone: '13800001112', email: 'li@sd.vts.msa.gov.cn',
                    certificates: ['船长', '轮机长'], education: '研究生及以上',
                    salary: 11500,
                    dutyHistory: ['2024-01-12', '2024-01-25', '2024-02-10'],
                    dutyHours: 88, remark: '负责全省VTS协调工作'
                }
            ],
            '青岛分局': [
                {
                    id: 3, name: '张伟', employeeId: 'QD001', gender: '男', birthDate: '1989-03-15',
                    unit: '青岛海事局VTS中心', role: '值班长', onDuty: '有', dutyTime: '夜班',
                    phone: '13800138001', email: 'zhangwei@qd.vts.msa.gov.cn',
                    certificates: ['船长', '大副'], education: '本科', 
                    salary: 9500,
                    dutyHistory: ['2024-01-15', '2024-01-20', '2024-02-01', '2024-02-15'],
                    dutyHours: 96, remark: '青岛港区值班长，经验丰富'
                },
                {
                    id: 4, name: '李红', employeeId: 'QD002', gender: '女', birthDate: '1996-07-01',
                    unit: '青岛海事局VTS中心', role: '值班员', onDuty: '有', dutyTime: '白班',
                    phone: '13800138002', email: 'lihong@qd.vts.msa.gov.cn',
                    certificates: ['大副', '二副'], education: '本科',
                    salary: 7800,
                    dutyHistory: ['2024-01-18', '2024-01-25', '2024-02-08'],
                    dutyHours: 72, remark: '青岛港VTS操作员'
                }
            ],
            '烟台分局': [
                {
                    id: 5, name: '王强', employeeId: 'YT001', gender: '男', birthDate: '1982-08-20',
                    unit: '烟台海事局VTS分中心', role: '值班长', onDuty: '有', dutyTime: '全天',
                    phone: '13800138003', email: 'wangqiang@yt.vts.msa.gov.cn',
                    certificates: ['船长', '轮机长', '大副'], education: '研究生及以上',
                    salary: 10200,
                    dutyHistory: ['2024-01-10', '2024-01-22', '2024-02-05', '2024-02-18'],
                    dutyHours: 96, remark: '烟台港区技术专家'
                },
                {
                    id: 6, name: '刘明', employeeId: 'YT002', gender: '男', birthDate: '1994-05-10',
                    unit: '烟台海事局VTS分中心', role: '值班员', onDuty: '有', dutyTime: '深夜班',
                    phone: '13800138004', email: 'liuming@yt.vts.msa.gov.cn',
                    certificates: ['二副', '三副'], education: '本科',
                    salary: 7500,
                    dutyHistory: ['2024-01-14', '2024-01-28', '2024-02-12'],
                    dutyHours: 72, remark: '烟台港VTS新秀'
                }
            ],
            '威海分局': [
                {
                    id: 7, name: '陈明', employeeId: 'WH001', gender: '男', birthDate: '1986-04-15',
                    unit: '威海海事局VTS分中心', role: '值班长', onDuty: '有', dutyTime: '白班',
                    phone: '13800138005', email: 'chenming@wh.vts.msa.gov.cn',
                    certificates: ['船长', '大副'], education: '本科',
                    salary: 9200,
                    dutyHistory: ['2024-01-16', '2024-01-30', '2024-02-14'],
                    dutyHours: 72, remark: '威海港区值班经验丰富'
                }
            ],
            '日照分局': [
                {
                    id: 8, name: '孙丽', employeeId: 'RZ001', gender: '女', birthDate: '1992-09-10',
                    unit: '日照海事局VTS分中心', role: '值班员', onDuty: '有', dutyTime: '夜班',
                    phone: '13800138006', email: 'sunli@rz.vts.msa.gov.cn',
                    certificates: ['大副', '二副'], education: '本科',
                    salary: 7800,
                    dutyHistory: ['2024-01-13', '2024-01-27', '2024-02-11'],
                    dutyHours: 72, remark: '日照港VTS操作熟练'
                }
            ],
            '东营分局': [
                {
                    id: 9, name: '赵勇', employeeId: 'DY001', gender: '男', birthDate: '1995-03-20',
                    unit: '东营海事局VTS分中心', role: '值班员', onDuty: '有', dutyTime: '白班',
                    phone: '13800138007', email: 'zhaoyong@dy.vts.msa.gov.cn',
                    certificates: ['二副', '三副'], education: '本科',
                    salary: 7200,
                    dutyHistory: ['2024-01-19', '2024-02-03'],
                    dutyHours: 48, remark: '东营港新进员工'
                }
            ],
            '潍坊分局': [
                {
                    id: 10, name: '马超', employeeId: 'WF001', gender: '男', birthDate: '1988-07-12',
                    unit: '潍坊海事局VTS分中心', role: '值班长', onDuty: '有', dutyTime: '夜班',
                    phone: '13800138008', email: 'machao@wf.vts.msa.gov.cn',
                    certificates: ['船长', '大副', '轮机长'], education: '本科',
                    salary: 9800,
                    dutyHistory: ['2024-01-11', '2024-01-24', '2024-02-07'],
                    dutyHours: 72, remark: '潍坊港区技术骨干'
                }
            ],
            '董家口分局': [
                {
                    id: 11, name: '杨帆', employeeId: 'DJK001', gender: '男', birthDate: '1991-11-05',
                    unit: '董家口海事局VTS分中心', role: '值班员', onDuty: '有', dutyTime: '白班',
                    phone: '13800138009', email: 'yangfan@djk.vts.msa.gov.cn',
                    certificates: ['大副', '二副'], education: '本科',
                    salary: 8200,
                    dutyHistory: ['2024-01-17', '2024-01-31', '2024-02-15'],
                    dutyHours: 72, remark: '董家口港新兴港区业务熟练'
                }
            ],
            '滨州分局': [
                {
                    id: 12, name: '周静', employeeId: 'BZ001', gender: '女', birthDate: '1997-08-15',
                    unit: '滨州海事局VTS分中心', role: '实习', onDuty: '有', dutyTime: '白班',
                    phone: '13800138010', email: 'zhoujing@bz.vts.msa.gov.cn',
                    certificates: [], education: '大专',
                    salary: 4500,
                    dutyHistory: ['2024-01-21', '2024-02-04'],
                    dutyHours: 48, remark: '滨州港实习生，表现优秀'
                }
            ]
        };

        let employees = [];
        let filteredEmployees = [];
        let editingEmployeeId = null;
        let calendar = null;
        
        // 分页相关变量
        let currentPage = 1;
        const pageSize = 10;

        /*********************
         * 工具函数
         *********************/
        
        // 计算年龄函数
        function calculateAge(prefix) {
            const birthDateInput = document.getElementById(prefix + 'BirthDate');
            const ageInput = document.getElementById(prefix + 'Age');
            
            if (birthDateInput.value && ageInput) {
                const birthDate = new Date(birthDateInput.value);
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                
                ageInput.value = age;
            }
        }

        // 根据出生日期计算年龄
        function calculateAgeFromBirthDate(birthDate) {
            if (!birthDate) return null;
            const birth = new Date(birthDate);
            const today = new Date();
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            
            return age;
        }
        
        // 防抖函数
        function debounce(fn, delay = 300) {
            let timeoutId;
            return function (...args) {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => fn.apply(this, args), delay);
            };
        }

        // 显示加载指示器
        function showLoading() {
            document.getElementById('loadingIndicator').classList.remove('hidden');
        }

        // 隐藏加载指示器
        function hideLoading() {
            document.getElementById('loadingIndicator').classList.add('hidden');
        }

        // 显示提示信息
        function showToast(message, type = 'info') {
            // 创建简单的toast提示
            const toast = document.createElement('div');
            const bgColor = type === 'error' ? 'bg-red-500' : type === 'success' ? 'bg-green-500' : 'bg-blue-500';
            toast.className = `fixed top-4 right-4 ${bgColor} text-white px-4 py-2 rounded-lg shadow-lg z-50 transition-opacity`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        /*********************
         * 页面切换函数（修复版）
         *********************/
        function showPage(pageId) {
            // 隐藏所有页面
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
                // 确保完全隐藏
                page.style.display = 'none';
            });
            
            // 显示目标页面
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                // 根据页面类型设置正确的display
                if (pageId === 'loginPage' || pageId === 'registerPage') {
                    targetPage.style.display = 'flex';
                } else {
                    targetPage.style.display = 'block';
                }
                
                // 立即滚动到页面顶部
                window.scrollTo({
                    top: 0,
                    left: 0,
                    behavior: 'instant'
                });
                
                // 确保滚动位置重置
                setTimeout(() => {
                    document.documentElement.scrollTop = 0;
                    document.body.scrollTop = 0;
                }, 10);
            }
        }

        function showLoginForm() {
            showPage('loginPage');
        }

        function showRegisterForm() {
            showPage('registerPage');
        }

        function showUserManagement() {
            showPage('userManagementPage');
            renderUserTable();
        }

        function backToMain() {
            showPage('mainPage');
        }

        /*********************
         * 登录注册功能（修复版）
         *********************/
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            const organization = document.getElementById('loginOrganization').value;
            
            if (!username || !password || !organization) {
                showToast('请填写完整的登录信息', 'error');
                return;
            }
            
            const user = users.find(u => 
                u.username === username && 
                u.password === password && 
                u.organization === organization &&
                u.status === 'active'
            );
            
            if (user) {
                currentUser = user;
                login(user);
            } else {
                showToast('用户名、密码或单位不正确！', 'error');
            }
        });

        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value;
            const passwordConfirm = document.getElementById('regPasswordConfirm').value;
            const realName = document.getElementById('regRealName').value.trim();
            const organization = document.getElementById('regOrganization').value;
            const userType = document.getElementById('regUserType').value;
            
            if (!username || !password || !realName || !organization) {
                showToast('请填写完整的注册信息', 'error');
                return;
            }
            
            if (password !== passwordConfirm) {
                showToast('两次输入的密码不一致！', 'error');
                return;
            }
            
            if (password.length < 6) {
                showToast('密码长度不能少于6位', 'error');
                return;
            }
            
            if (users.find(u => u.username === username)) {
                showToast('用户名已存在！', 'error');
                return;
            }
            
            const newUser = {
                id: Math.max(...users.map(u => u.id)) + 1,
                username,
                password,
                realName,
                organization,
                userType,
                status: userType === 'admin' ? 'pending' : 'active',
                registeredAt: new Date().toISOString().split('T')[0]
            };
            
            users.push(newUser);
            
            if (userType === 'admin') {
                showToast('管理员账号注册成功，等待审核批准后方可使用！', 'success');
            } else {
                showToast('注册成功！现在可以登录了。', 'success');
            }
            
            showLoginForm();
            
            // 清空表单
            document.getElementById('registerForm').reset();
        });

        function login(user) {
            // 显示加载状态
            showLoading();
            
            // 更新用户信息显示
            document.getElementById('currentUserName').textContent = user.realName;
            document.getElementById('currentUserOrg').textContent = user.organization;
            document.getElementById('currentUserRole').textContent = user.userType === 'admin' ? '管理员' : '普通用户';
            
            // 根据用户权限显示/隐藏功能
            if (user.userType === 'admin') {
                document.getElementById('addEmployeeBtn').classList.remove('hidden');
                document.getElementById('bulkActionsBtn').classList.remove('hidden');
                document.getElementById('resetDataBtn').classList.remove('hidden');
                document.getElementById('userManagementBtn').classList.remove('hidden');
                document.getElementById('selectAll').style.display = 'inline';
            } else {
                document.getElementById('addEmployeeBtn').classList.add('hidden');
                document.getElementById('bulkActionsBtn').classList.add('hidden');
                document.getElementById('resetDataBtn').classList.add('hidden');
                document.getElementById('userManagementBtn').classList.add('hidden');
                document.getElementById('selectAll').style.display = 'none';
            }
            
            // 延迟执行页面切换，确保数据加载完成
            setTimeout(() => {
                // 加载对应单位的员工数据
                loadEmployeeData();
                
                // 切换到主页面
                showPage('mainPage');
                
                hideLoading();
                showToast('登录成功！', 'success');
                
                // 额外确保滚动位置正确
                setTimeout(() => {
                    window.scrollTo(0, 0);
                }, 100);
            }, 300);
        }

        function logout() {
            if (confirm('确定要退出登录吗？')) {
                currentUser = null;
                employees = [];
                filteredEmployees = [];
                currentPage = 1;
                
                // 隐藏日历
                document.getElementById('calendarSection').classList.add('hidden');
                
                showPage('loginPage');
                
                // 清空表单
                document.getElementById('loginForm').reset();
                
                showToast('已安全退出登录', 'info');
            }
        }

        /*********************
         * 数据加载与管理
         *********************/
        function loadEmployeeData() {
            if (!currentUser) return;
            
            if (currentUser.organization === '省厅') {
                // 省厅用户可以看到所有数据
                employees = [];
                Object.values(employeesByOrganization).forEach(orgEmployees => {
                    employees.push(...orgEmployees);
                });
            } else {
                // 分局用户只能看到本单位数据
                employees = employeesByOrganization[currentUser.organization] || [];
            }
            
            filteredEmployees = [...employees];
            currentPage = 1; // 重置到第一页
            renderEmployeeTable();
            updateFilters();
            updateStats();
        }

        function renderUserTable() {
            const tbody = document.getElementById('userTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                const statusColor = user.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800';
                const statusText = user.status === 'active' ? '正常' : '待审核';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.username}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.realName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.organization}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${user.userType === 'admin' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'}">
                            ${user.userType === 'admin' ? '管理员' : '普通用户'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${statusColor}">
                            ${statusText}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.registeredAt}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        ${user.status === 'pending' ? 
                            `<button onclick="approveUser(${user.id})" class="text-green-600 hover:text-green-900 mr-2 focus:outline-none focus:underline">批准</button>
                             <button onclick="rejectUser(${user.id})" class="text-red-600 hover:text-red-900 focus:outline-none focus:underline">拒绝</button>` :
                            `<button onclick="toggleUserStatus(${user.id})" class="text-gray-600 hover:text-gray-900 focus:outline-none focus:underline">
                                ${user.status === 'active' ? '禁用' : '启用'}
                             </button>`
                        }
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function approveUser(userId) {
            const user = users.find(u => u.id === userId);
            if (user) {
                user.status = 'active';
                showToast(`用户 ${user.realName} 已批准！`, 'success');
                renderUserTable();
            }
        }

        function rejectUser(userId) {
            if (confirm('确定要拒绝这个用户的注册申请吗？')) {
                users = users.filter(u => u.id !== userId);
                renderUserTable();
                showToast('用户申请已拒绝', 'info');
            }
        }

        function toggleUserStatus(userId) {
            const user = users.find(u => u.id === userId);
            if (user && confirm(`确定要${user.status === 'active' ? '禁用' : '启用'}这个用户吗？`)) {
                user.status = user.status === 'active' ? 'disabled' : 'active';
                renderUserTable();
                showToast(`用户状态已${user.status === 'active' ? '启用' : '禁用'}`, 'info');
            }
        }

        /*********************
         * 员工管理功能
         *********************/

        // 身份变化处理
        function handleRoleChange(prefix) {
            const roleSelect = document.getElementById(prefix + 'Role');
            const onDutySelect = document.getElementById(prefix + 'OnDuty');
            
            if (roleSelect && onDutySelect) {
                if (roleSelect.value === '协管' || roleSelect.value === '实习') {
                    onDutySelect.value = '有';
                    onDutySelect.disabled = true;
                } else {
                    onDutySelect.disabled = false;
                }
            }
        }

        // 计算值班时间
        function calculateDutyHours(dutyHistory) {
            return dutyHistory ? dutyHistory.length * 24 : 0;
        }

        // 获取身份颜色
        function getRoleColor(role) {
            switch(role) {
                case '值班长': return 'bg-red-100 text-red-800';
                case '值班员': return 'bg-blue-100 text-blue-800';
                case '协管': return 'bg-green-100 text-green-800';
                case '实习': return 'bg-gray-100 text-gray-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // 获取在岗状态颜色
        function getOnDutyColor(onDuty) {
            return onDuty === '有' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
        }

        // 渲染员工表格（带分页）
        function renderEmployeeTable() {
            const tbody = document.getElementById('employeeTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // 计算分页
            const totalItems = filteredEmployees.length;
            const totalPages = Math.ceil(totalItems / pageSize);
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, totalItems);
            const pageEmployees = filteredEmployees.slice(startIndex, endIndex);
            
            pageEmployees.forEach(emp => {
                const dutyHours = emp.dutyHours || calculateDutyHours(emp.dutyHistory);
                const certCount = emp.certificates ? emp.certificates.length : 0;
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors';
                
                const isAdmin = currentUser && currentUser.userType === 'admin';
                const actionButtons = isAdmin ? `
                    <button onclick="viewEmployee(${emp.id})" 
                            class="text-blue-600 hover:text-blue-900 mr-2 focus:outline-none focus:underline" 
                            title="查看详情" aria-label="查看 ${emp.name} 的详情">
                        查看
                    </button>
                    <button onclick="editEmployee(${emp.id})" 
                            class="text-indigo-600 hover:text-indigo-900 mr-2 focus:outline-none focus:underline" 
                            title="编辑信息" aria-label="编辑 ${emp.name} 的信息">
                        编辑
                    </button>
                    <button onclick="deleteEmployee(${emp.id})" 
                            class="text-red-600 hover:text-red-900 focus:outline-none focus:underline" 
                            title="删除员工" aria-label="删除员工 ${emp.name}">
                        删除
                    </button>
                ` : `
                    <button onclick="viewEmployee(${emp.id})" 
                            class="text-blue-600 hover:text-blue-900 focus:outline-none focus:underline" 
                            title="查看详情" aria-label="查看 ${emp.name} 的详情">
                        查看
                    </button>
                `;

                const checkboxColumn = isAdmin ? 
                    `<input type="checkbox" class="employee-checkbox mr-3" value="${emp.id}" aria-label="选择 ${emp.name}">` : 
                    '<span class="mr-3"></span>';
                
                row.innerHTML = `
                    <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            ${checkboxColumn}
                            <div class="h-8 w-8 md:h-10 md:w-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-medium text-sm" 
                                 aria-hidden="true">
                                ${emp.name.charAt(0)}
                            </div>
                            <div class="ml-2 md:ml-4">
                                <div class="text-sm font-medium text-gray-900">${emp.name}</div>
                                <div class="text-xs md:text-sm text-gray-500">${emp.employeeId}</div>
                                <div class="text-xs text-gray-500">${emp.gender} | ${emp.birthDate ? calculateAgeFromBirthDate(emp.birthDate) : 'N/A'}岁 | ${emp.education}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                        <div class="text-xs md:text-sm text-gray-900">${emp.unit.length > 15 ? emp.unit.substring(0, 12) + '...' : emp.unit}</div>
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${getRoleColor(emp.role)}">
                            ${emp.role}
                        </span>
                        <div class="text-xs text-gray-500 mt-1">值班: ${emp.dutyTime || '未设置'}</div>
                    </td>
                    <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${getOnDutyColor(emp.onDuty)}">
                            ${emp.onDuty === '有' ? '在岗' : '不在岗'}
                        </span>
                    </td>
                    <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                        <div class="text-xs md:text-sm text-gray-900">${dutyHours}小时</div>
                        <div class="text-xs text-gray-500">${emp.dutyHistory ? emp.dutyHistory.length : 0}次值班</div>
                        <button onclick="showDutyHistory(${emp.id})" 
                                class="text-blue-600 hover:text-blue-900 text-xs focus:outline-none focus:underline"
                                aria-label="查看 ${emp.name} 的值班详情">
                            查看详情
                        </button>
                    </td>
                    <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                        <div class="text-xs md:text-sm text-gray-900">${certCount}个证书</div>
                        <div class="text-xs text-gray-500">
                            ${emp.certificates && emp.certificates.length > 0 ? 
                                emp.certificates.slice(0, 2).join(', ') + (emp.certificates.length > 2 ? '...' : '') : 
                                '暂无证书'
                            }
                        </div>
                    </td>
                    <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                        <div class="text-xs md:text-sm text-gray-900">${emp.phone || '-'}</div>
                        <div class="text-xs text-gray-500">${emp.email || '-'}</div>
                    </td>
                    <td class="px-3 md:px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex flex-col space-y-1">
                            ${actionButtons}
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // 更新分页控件
            updatePagination(totalItems, totalPages);
        }

        // 更新分页控件
        function updatePagination(totalItems, totalPages) {
            const startItem = totalItems > 0 ? ((currentPage - 1) * pageSize) + 1 : 0;
            const endItem = Math.min(currentPage * pageSize, totalItems);
            
            // 更新分页信息
            document.getElementById('startItem').textContent = startItem;
            document.getElementById('endItem').textContent = endItem;
            document.getElementById('totalItems').textContent = totalItems;
            
            // 更新按钮状态
            const prevPageBtn = document.getElementById('prevPage');
            const nextPageBtn = document.getElementById('nextPage');
            const prevPageMobileBtn = document.getElementById('prevPageMobile');
            const nextPageMobileBtn = document.getElementById('nextPageMobile');
            
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
            prevPageMobileBtn.disabled = currentPage === 1;
            nextPageMobileBtn.disabled = currentPage === totalPages;
            
            // 生成页码按钮
            const pageNumbers = document.getElementById('pageNumbers');
            pageNumbers.innerHTML = '';
            
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            // 调整起始页
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `relative inline-flex items-center px-4 py-2 border text-sm font-medium ${
                    i === currentPage 
                        ? 'z-10 bg-indigo-50 border-indigo-500 text-indigo-600' 
                        : 'bg-white border-gray-300 text-gray-500 hover:bg-gray-50'
                }`;
                pageBtn.textContent = i;
                pageBtn.onclick = () => goToPage(i);
                pageNumbers.appendChild(pageBtn);
            }
            
            // 绑定分页按钮事件
            prevPageBtn.onclick = () => goToPage(currentPage - 1);
            nextPageBtn.onclick = () => goToPage(currentPage + 1);
            prevPageMobileBtn.onclick = () => goToPage(currentPage - 1);
            nextPageMobileBtn.onclick = () => goToPage(currentPage + 1);
        }

        function goToPage(page) {
            const totalPages = Math.ceil(filteredEmployees.length / pageSize);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderEmployeeTable();
                // 滚动到表格顶部
                const table = document.querySelector('.responsive-table');
                if (table) {
                    table.scrollIntoView({ 
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            }
        }

        // 更新筛选选项
        function updateFilters() {
            const units = [...new Set(employees.map(emp => emp.unit))];
            
            const unitFilter = document.getElementById('unitFilter');
            if (unitFilter) {
                unitFilter.innerHTML = '<option value="">所有单位</option>';
                units.forEach(unit => {
                    unitFilter.innerHTML += `<option value="${unit}">${unit}</option>`;
                });
            }
        }

        // 更新统计数据
        function updateStats() {
            const elements = {
                totalCount: employees.length,
                onDutyCount: employees.filter(emp => emp.onDuty === '有').length,
                supervisorCount: employees.filter(emp => emp.role === '值班长').length,
                certifiedCount: employees.filter(emp => emp.certificates && emp.certificates.length > 0).length,
                monthlyDutyHours: employees.reduce((sum, emp) => sum + (emp.dutyHours || 0), 0)
            };

            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) {
                    // 添加数字变化动画效果
                    const currentValue = parseInt(element.textContent) || 0;
                    if (currentValue !== value) {
                        animateNumber(element, currentValue, value);
                    }
                }
            });
        }

        // 数字动画效果
        function animateNumber(element, start, end, duration = 1000) {
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    element.textContent = end;
                    clearInterval(timer);
                } else {
                    element.textContent = Math.round(current);
                }
            }, 16);
        }

        // 搜索和筛选（带防抖）
        const debouncedFilter = debounce(function() {
            const search = document.getElementById('searchInput')?.value.toLowerCase() || '';
            const unit = document.getElementById('unitFilter')?.value || '';
            const role = document.getElementById('roleFilter')?.value || '';
            const onDuty = document.getElementById('onDutyFilter')?.value || '';
            const dutyTimeRange = document.getElementById('dutyTimeFilter')?.value || '';
            const certificateFilter = document.getElementById('certificateFilter')?.value || '';
            const education = document.getElementById('educationFilter')?.value || '';
            
            filteredEmployees = employees.filter(emp => {
                const matchesSearch = emp.name.toLowerCase().includes(search) ||
                                    emp.employeeId.toLowerCase().includes(search) ||
                                    emp.unit.toLowerCase().includes(search) ||
                                    (emp.phone && emp.phone.includes(search)) ||
                                    (emp.email && emp.email.toLowerCase().includes(search)) ||
                                    (emp.remark && emp.remark.toLowerCase().includes(search));
                
                const matchesUnit = !unit || emp.unit === unit;
                const matchesRole = !role || emp.role === role;
                const matchesOnDuty = !onDuty || emp.onDuty === onDuty;
                const matchesEducation = !education || emp.education === education;
                
                let matchesDutyTime = true;
                if (dutyTimeRange) {
                    const dutyHours = emp.dutyHours || 0;
                    if (dutyTimeRange === '0-50') {
                        matchesDutyTime = dutyHours >= 0 && dutyHours <= 50;
                    } else if (dutyTimeRange === '51-100') {
                        matchesDutyTime = dutyHours >= 51 && dutyHours <= 100;
                    } else if (dutyTimeRange === '101-150') {
                        matchesDutyTime = dutyHours >= 101 && dutyHours <= 150;
                    } else if (dutyTimeRange === '151+') {
                        matchesDutyTime = dutyHours >= 151;
                    }
                }
                
                let matchesCertificate = true;
                if (certificateFilter) {
                    const empCertificates = emp.certificates || [];
                    if (certificateFilter === '有证书') {
                        matchesCertificate = empCertificates.length > 0;
                    } else if (certificateFilter === '无证书') {
                        matchesCertificate = empCertificates.length === 0;
                    } else {
                        matchesCertificate = empCertificates.includes(certificateFilter);
                    }
                }
                
                return matchesSearch && matchesUnit && matchesRole && matchesOnDuty && matchesEducation && matchesDutyTime && matchesCertificate;
            });
            
            currentPage = 1; // 重置到第一页
            renderEmployeeTable();
        }, 300);

        /*********************
         * 员工详情与操作
         *********************/

        // 查看员工详情
        function viewEmployee(id) {
            const employee = employees.find(emp => emp.id === id);
            if (!employee) return;
            
            const dutyHours = employee.dutyHours || 0;
            const dutyCount = employee.dutyHistory ? employee.dutyHistory.length : 0;
            const avgDutyPerMonth = dutyCount > 0 ? Math.round((dutyHours / 12) * 10) / 10 : 0;
            const currentAge = employee.birthDate ? calculateAgeFromBirthDate(employee.birthDate) : 'N/A';
            
            const detailsContent = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- 基本信息 -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-medium text-gray-900 border-b border-gray-200 pb-2">基本信息</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-sm font-medium text-gray-500">姓名:</span>
                                <span class="text-sm text-gray-900">${employee.name}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm font-medium text-gray-500">工号:</span>
                                <span class="text-sm text-gray-900">${employee.employeeId}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm font-medium text-gray-500">性别:</span>
                                <span class="text-sm text-gray-900">${employee.gender}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm font-medium text-gray-500">出生日期:</span>
                                <span class="text-sm text-gray-900">${employee.birthDate || '未知'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm font-medium text-gray-500">年龄:</span>
                                <span class="text-sm text-gray-900">${currentAge}岁</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm font-medium text-gray-500">学历:</span>
                                <span class="text-sm text-gray-900">${employee.education || '未知'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm font-medium text-gray-500">薪资:</span>
                                <span class="text-sm text-gray-900">¥${employee.salary || 0}</span>
                            </div>
                        </div>
                    </div>

                    <!-- 工作信息 -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-medium text-gray-900 border-b border-gray-200 pb-2">工作信息</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-sm font-medium text-gray-500">单位:</span>
                                <span class="text-sm text-gray-900">${employee.unit}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm font-medium text-gray-500">身份:</span>
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${getRoleColor(employee.role)}">${employee.role}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm font-medium text-gray-500">在岗情况:</span>
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${getOnDutyColor(employee.onDuty)}">${employee.onDuty === '有' ? '在岗' : '不在岗'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm font-medium text-gray-500">值班时间:</span>
                                <span class="text-sm text-gray-900">${employee.dutyTime || '未设置'}</span>
                            </div>
                        </div>
                    </div>

                    <!-- 值班信息 -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-medium text-gray-900 border-b border-gray-200 pb-2">值班信息</h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-blue-50 p-3 rounded-lg">
                                <div class="text-lg font-semibold text-blue-900">${dutyCount}</div>
                                <div class="text-sm text-blue-600">总值班次数</div>
                            </div>
                            <div class="bg-green-50 p-3 rounded-lg">
                                <div class="text-lg font-semibold text-green-900">${dutyHours}</div>
                                <div class="text-sm text-green-600">总值班时间(小时)</div>
                            </div>
                        </div>
                        <div class="text-sm text-gray-600">
                            平均每月值班: ${avgDutyPerMonth} 小时
                        </div>
                        <button onclick="hideViewModal(); showDutyHistory(${employee.id})" 
                                class="w-full bg-indigo-600 hover:bg-indigo-700 focus:ring-4 focus:ring-indigo-200 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                            查看值班历史
                        </button>
                    </div>

                    <!-- 证书信息 -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-medium text-gray-900 border-b border-gray-200 pb-2">证书信息</h4>
                        <div class="space-y-2">
                            ${employee.certificates && employee.certificates.length > 0 ? 
                                employee.certificates.map(cert => 
                                    `<span class="inline-flex px-3 py-1 text-sm bg-blue-100 text-blue-800 rounded-full mr-2 mb-2">${cert}</span>`
                                ).join('') : 
                                '<div class="text-sm text-gray-400 italic">暂无证书信息</div>'
                            }
                        </div>
                    </div>

                    <!-- 联系信息 -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-medium text-gray-900 border-b border-gray-200 pb-2">联系信息</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-sm font-medium text-gray-500">电话:</span>
                                <span class="text-sm text-gray-900">${employee.phone || '-'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm font-medium text-gray-500">邮箱:</span>
                                <span class="text-sm text-gray-900">${employee.email || '-'}</span>
                            </div>
                        </div>
                    </div>

                    <!-- 备注信息 -->
                    <div class="space-y-4 md:col-span-2">
                        <h4 class="text-lg font-medium text-gray-900 border-b border-gray-200 pb-2">备注信息</h4>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-700">${employee.remark || '暂无备注信息'}</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('employeeDetails').innerHTML = detailsContent;
            document.getElementById('viewModal').classList.add('show');
            
            // 设置焦点以支持键盘导航
            setTimeout(() => {
                const modal = document.getElementById('viewModal');
                const firstFocusable = modal.querySelector('button');
                if (firstFocusable) {
                    firstFocusable.focus();
                }
            }, 100);
        }

        function hideViewModal() {
            document.getElementById('viewModal').classList.remove('show');
        }

        // 编辑员工
        function editEmployee(id) {
            if (!currentUser || currentUser.userType !== 'admin') {
                showToast('没有权限执行此操作！', 'error');
                return;
            }
            
            const employee = employees.find(emp => emp.id === id);
            if (!employee) return;
            
            editingEmployeeId = id;
            
            // 填充基本信息
            document.getElementById('editName').value = employee.name;
            document.getElementById('editEmpId').value = employee.employeeId;
            document.getElementById('editGender').value = employee.gender;
            document.getElementById('editBirthDate').value = employee.birthDate || '';
            document.getElementById('editAge').value = employee.birthDate ? calculateAgeFromBirthDate(employee.birthDate) : '';
            document.getElementById('editEducation').value = employee.education || '本科';
            document.getElementById('editSalary').value = employee.salary;
            
            // 填充工作信息
            document.getElementById('editUnit').value = employee.unit;
            document.getElementById('editRole').value = employee.role;
            document.getElementById('editOnDuty').value = employee.onDuty;
            document.getElementById('editDutyTime').value = employee.dutyTime || '白班';
            
            // 填充证书信息
            const certCheckboxes = [
                { id: 'editCertCaptain', name: '船长' },
                { id: 'editCertChiefOfficer', name: '大副' },
                { id: 'editCertSecondOfficer', name: '二副' },
                { id: 'editCertThirdOfficer', name: '三副' },
                { id: 'editCertChiefEngineer', name: '轮机长' },
                { id: 'editCertFirstEngineer', name: '大管轮' },
                { id: 'editCertSecondEngineer', name: '二管轮' },
                { id: 'editCertElectrician', name: '电机员' }
            ];
            
            certCheckboxes.forEach(cert => {
                const checkbox = document.getElementById(cert.id);
                if (checkbox) {
                    checkbox.checked = employee.certificates && employee.certificates.includes(cert.name);
                }
            });
            
            // 填充联系信息
            document.getElementById('editPhone').value = employee.phone;
            document.getElementById('editEmail').value = employee.email;
            document.getElementById('editRemark').value = employee.remark || '';
            
            // 处理身份变化逻辑
            handleRoleChange('edit');
            
            document.getElementById('editModal').classList.add('show');
            
            // 设置焦点
            setTimeout(() => {
                document.getElementById('editName').focus();
            }, 100);
        }

        function hideEditModal() {
            document.getElementById('editModal').classList.remove('show');
            editingEmployeeId = null;
        }

        function saveEditEmployee() {
            if (!editingEmployeeId) return;
            
            const empIndex = employees.findIndex(emp => emp.id === editingEmployeeId);
            if (empIndex === -1) return;
            
            const name = document.getElementById('editName').value.trim();
            const employeeId = document.getElementById('editEmpId').value.trim();
            
            if (!name || !employeeId) {
                showToast('请填写姓名和工号！', 'error');
                return;
            }

            // 检查工号重复（排除当前编辑的员工）
            const existingEmployee = employees.find(emp => emp.employeeId === employeeId && emp.id !== editingEmployeeId);
            if (existingEmployee) {
                showToast('工号已存在，请使用其他工号！', 'error');
                return;
            }

            // 获取证书
            const certificates = [];
            const certCheckboxes = [
                { id: 'editCertCaptain', name: '船长' },
                { id: 'editCertChiefOfficer', name: '大副' },
                { id: 'editCertSecondOfficer', name: '二副' },
                { id: 'editCertThirdOfficer', name: '三副' },
                { id: 'editCertChiefEngineer', name: '轮机长' },
                { id: 'editCertFirstEngineer', name: '大管轮' },
                { id: 'editCertSecondEngineer', name: '二管轮' },
                { id: 'editCertElectrician', name: '电机员' }
            ];
            
            certCheckboxes.forEach(cert => {
                const checkbox = document.getElementById(cert.id);
                if (checkbox && checkbox.checked) {
                    certificates.push(cert.name);
                }
            });
            
            // 更新员工信息
            employees[empIndex] = {
                ...employees[empIndex],
                name: name,
                employeeId: employeeId,
                gender: document.getElementById('editGender').value,
                birthDate: document.getElementById('editBirthDate').value,
                education: document.getElementById('editEducation').value,
                salary: parseInt(document.getElementById('editSalary').value) || 5000,
                unit: document.getElementById('editUnit').value.trim(),
                role: document.getElementById('editRole').value,
                onDuty: document.getElementById('editOnDuty').value,
                dutyTime: document.getElementById('editDutyTime').value,
                certificates: certificates,
                phone: document.getElementById('editPhone').value.trim(),
                email: document.getElementById('editEmail').value.trim(),
                remark: document.getElementById('editRemark').value.trim()
            };
            
            // 同步更新到employeesByOrganization
            updateEmployeesByOrganization();
            
            filteredEmployees = [...employees];
            renderEmployeeTable();
            updateFilters();
            updateStats();
            hideEditModal();
            showToast('员工信息更新成功！', 'success');
        }

        // 删除员工
        function deleteEmployee(id) {
            if (!currentUser || currentUser.userType !== 'admin') {
                showToast('没有权限执行此操作！', 'error');
                return;
            }
            
            const employee = employees.find(emp => emp.id === id);
            if (!employee) return;
            
            if (confirm(`确定要删除员工 ${employee.name} 吗？此操作不可恢复！`)) {
                employees = employees.filter(emp => emp.id !== id);
                filteredEmployees = [...employees];
                
                // 同步更新到employeesByOrganization
                updateEmployeesByOrganization();
                
                // 如果当前页没有数据，回到上一页
                const totalPages = Math.ceil(filteredEmployees.length / pageSize);
                if (currentPage > totalPages && totalPages > 0) {
                    currentPage = totalPages;
                }
                
                renderEmployeeTable();
                updateStats();
                showToast('员工删除成功！', 'success');
            }
        }

        // 显示值班历史
        function showDutyHistory(id) {
            const employee = employees.find(emp => emp.id === id);
            if (!employee) return;
            
            const isAdmin = currentUser && currentUser.userType === 'admin';
            const dutyHistoryContent = `
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <h4 class="text-lg font-medium">${employee.name} 的值班历史</h4>
                        ${isAdmin ? `<button onclick="addNewDutyRecord(${id})" 
                                             class="bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-200 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                            添加值班记录
                        </button>` : ''}
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h5 class="font-medium text-gray-900 mb-2">值班统计</h5>
                            <div class="space-y-1 text-sm">
                                <div>总值班次数: <span class="font-medium">${employee.dutyHistory ? employee.dutyHistory.length : 0}</span></div>
                                <div>总值班时间: <span class="font-medium">${employee.dutyHours || 0}小时</span></div>
                                <div>平均每月: <span class="font-medium">${Math.round((employee.dutyHours || 0) / 12 * 10) / 10}小时</span></div>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h5 class="font-medium text-blue-900 mb-2">最近值班</h5>
                            ${employee.dutyHistory && employee.dutyHistory.length > 0 ? 
                                `<div class="text-sm text-blue-800">${employee.dutyHistory[employee.dutyHistory.length - 1]}</div>` :
                                '<div class="text-sm text-blue-600">暂无值班记录</div>'
                            }
                        </div>
                    </div>
                    
                    <div>
                        <h5 class="font-medium text-gray-900 mb-3">值班记录</h5>
                        <div class="max-h-64 overflow-y-auto border rounded-lg">
                            ${employee.dutyHistory && employee.dutyHistory.length > 0 ? 
                                employee.dutyHistory.map((date, index) => `
                                    <div class="flex justify-between items-center p-3 border-b last:border-b-0 hover:bg-gray-50 transition-colors">
                                        <div>
                                            <div class="font-medium">${date}</div>
                                            <div class="text-sm text-gray-500">第${index + 1}次值班 - 24小时</div>
                                        </div>
                                        ${isAdmin ? `<button onclick="removeDutyRecord(${id}, ${index})" 
                                                             class="text-red-600 hover:text-red-900 focus:outline-none focus:underline text-sm">
                                            删除
                                        </button>` : ''}
                                    </div>
                                `).join('') :
                                '<div class="p-8 text-center text-gray-500">暂无值班记录</div>'
                            }
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('dutyHistoryContent').innerHTML = dutyHistoryContent;
            document.getElementById('dutyHistoryModal').classList.add('show');
        }

        function hideDutyHistoryModal() {
            document.getElementById('dutyHistoryModal').classList.remove('show');
        }

        // 添加值班记录
        function addNewDutyRecord(id) {
            const date = prompt('请输入值班日期 (格式: YYYY-MM-DD):');
            if (date && /^\d{4}-\d{2}-\d{2}$/.test(date)) {
                const empIndex = employees.findIndex(emp => emp.id === id);
                if (empIndex !== -1) {
                    if (!employees[empIndex].dutyHistory) {
                        employees[empIndex].dutyHistory = [];
                    }
                    employees[empIndex].dutyHistory.push(date);
                    employees[empIndex].dutyHistory.sort(); // 按日期排序
                    employees[empIndex].dutyHours = calculateDutyHours(employees[empIndex].dutyHistory);
                    
                    updateEmployeesByOrganization();
                    showDutyHistory(id); // 刷新显示
                    renderEmployeeTable();
                    updateStats();
                    showToast('值班记录添加成功！', 'success');
                }
            } else if (date) {
                showToast('日期格式不正确，请使用 YYYY-MM-DD 格式', 'error');
            }
        }

        // 删除值班记录
        function removeDutyRecord(id, index) {
            if (confirm('确定要删除这条值班记录吗？')) {
                const empIndex = employees.findIndex(emp => emp.id === id);
                if (empIndex !== -1 && employees[empIndex].dutyHistory) {
                    employees[empIndex].dutyHistory.splice(index, 1);
                    employees[empIndex].dutyHours = calculateDutyHours(employees[empIndex].dutyHistory);
                    
                    updateEmployeesByOrganization();
                    showDutyHistory(id); // 刷新显示
                    renderEmployeeTable();
                    updateStats();
                    showToast('值班记录删除成功！', 'success');
                }
            }
        }

        /*********************
         * 添加员工功能
         *********************/
        
        function showAddModal() {
            if (!currentUser || currentUser.userType !== 'admin') {
                showToast('没有权限执行此操作！', 'error');
                return;
            }
            
            // 清空表单
            document.getElementById('addEmployeeForm').reset();
            
            // 设置默认值
            document.getElementById('newUnit').value = getCurrentUserUnit();
            document.getElementById('newDutyTime').value = '白班';
            
            // 清空证书复选框
            const certCheckboxes = [
                'newCertCaptain', 'newCertChiefOfficer', 'newCertSecondOfficer', 'newCertThirdOfficer',
                'newCertChiefEngineer', 'newCertFirstEngineer', 'newCertSecondEngineer', 'newCertElectrician'
            ];
            certCheckboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) checkbox.checked = false;
            });
            
            // 清空年龄字段
            document.getElementById('newAge').value = '';
            
            // 处理身份变化逻辑
            handleRoleChange('new');
            
            document.getElementById('addModal').classList.add('show');
            
            // 设置焦点
            setTimeout(() => {
                document.getElementById('newName').focus();
            }, 100);
        }

        function hideAddModal() {
            document.getElementById('addModal').classList.remove('show');
        }

        function addEmployee() {
            const name = document.getElementById('newName').value.trim();
            const employeeId = document.getElementById('newEmpId').value.trim();
            
            if (!name || !employeeId) {
                showToast('请填写姓名和工号！', 'error');
                return;
            }

            // 检查工号是否重复
            if (employees.find(emp => emp.employeeId === employeeId)) {
                showToast('工号已存在，请使用其他工号！', 'error');
                return;
            }

            // 验证邮箱格式
            const email = document.getElementById('newEmail').value.trim();
            if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showToast('邮箱格式不正确！', 'error');
                return;
            }

            // 验证电话格式
            const phone = document.getElementById('newPhone').value.trim();
            if (phone && !/^1[3-9]\d{9}$/.test(phone)) {
                showToast('手机号格式不正确！', 'error');
                return;
            }

            // 获取证书
            const certificates = [];
            const certCheckboxes = [
                { id: 'newCertCaptain', name: '船长' },
                { id: 'newCertChiefOfficer', name: '大副' },
                { id: 'newCertSecondOfficer', name: '二副' },
                { id: 'newCertThirdOfficer', name: '三副' },
                { id: 'newCertChiefEngineer', name: '轮机长' },
                { id: 'newCertFirstEngineer', name: '大管轮' },
                { id: 'newCertSecondEngineer', name: '二管轮' },
                { id: 'newCertElectrician', name: '电机员' }
            ];
            
            certCheckboxes.forEach(cert => {
                const checkbox = document.getElementById(cert.id);
                if (checkbox && checkbox.checked) {
                    certificates.push(cert.name);
                }
            });

            showLoading();

            const newEmp = {
                id: Math.max(...employees.map(emp => emp.id), 0) + 1,
                name: name,
                employeeId: employeeId,
                gender: document.getElementById('newGender').value,
                birthDate: document.getElementById('newBirthDate').value,
                unit: document.getElementById('newUnit').value.trim() || getCurrentUserUnit(),
                role: document.getElementById('newRole').value,
                onDuty: document.getElementById('newOnDuty').value,
                dutyTime: document.getElementById('newDutyTime').value,
                phone: phone,
                email: email,
                certificates: certificates,
                education: document.getElementById('newEducation').value,
                salary: parseInt(document.getElementById('newSalary').value) || 5000,
                dutyHistory: [],
                dutyHours: 0,
                remark: document.getElementById('newRemark').value.trim()
            };
            
            // 模拟异步操作
            setTimeout(() => {
                employees.push(newEmp);
                filteredEmployees = [...employees];
                
                // 同步更新到employeesByOrganization
                updateEmployeesByOrganization();
                
                renderEmployeeTable();
                updateFilters();
                updateStats();
                hideAddModal();
                hideLoading();
                showToast('员工添加成功！', 'success');
            }, 500);
        }

        // 获取当前用户单位对应的VTS中心名称
        function getCurrentUserUnit() {
            if (!currentUser) return '';
            
            const unitMap = {
                '省厅': '山东海事局VTS中心',
                '烟台分局': '烟台海事局VTS分中心',
                '青岛分局': '青岛海事局VTS中心',
                '威海分局': '威海海事局VTS分中心',
                '日照分局': '日照海事局VTS分中心',
                '东营分局': '东营海事局VTS分中心',
                '潍坊分局': '潍坊海事局VTS分中心',
                '董家口分局': '董家口海事局VTS分中心',
                '滨州分局': '滨州海事局VTS分中心'
            };
            
            return unitMap[currentUser.organization] || '';
        }

        // 同步更新employeesByOrganization
        function updateEmployeesByOrganization() {
            // 清空所有组织的员工数据
            Object.keys(employeesByOrganization).forEach(org => {
                employeesByOrganization[org] = [];
            });
            
            // 重新分组员工数据
            employees.forEach(emp => {
                const unitToOrgMap = {
                    '山东海事局VTS中心': '省厅',
                    '烟台海事局VTS分中心': '烟台分局',
                    '青岛海事局VTS中心': '青岛分局',
                    '威海海事局VTS分中心': '威海分局',
                    '日照海事局VTS分中心': '日照分局',
                    '东营海事局VTS分中心': '东营分局',
                    '潍坊海事局VTS分中心': '潍坊分局',
                    '董家口海事局VTS分中心': '董家口分局',
                    '滨州海事局VTS分中心': '滨州分局'
                };
                
                const org = unitToOrgMap[emp.unit];
                if (org && employeesByOrganization[org]) {
                    employeesByOrganization[org].push(emp);
                }
            });
        }

        /*********************
         * 批量操作功能
         *********************/
        
        function showBulkActions() {
            if (!currentUser || currentUser.userType !== 'admin') {
                showToast('没有权限执行此操作！', 'error');
                return;
            }
            updateSelectedCount();
            document.getElementById('bulkModal').classList.add('show');
        }

        function hideBulkModal() {
            document.getElementById('bulkModal').classList.remove('show');
        }

        function getSelectedEmployees() {
            const checkboxes = document.querySelectorAll('.employee-checkbox:checked');
            return Array.from(checkboxes).map(cb => parseInt(cb.value));
        }

        function updateSelectedCount() {
            const selectedCount = getSelectedEmployees().length;
            const countElement = document.getElementById('selectedCount');
            if (countElement) {
                countElement.textContent = selectedCount;
            }
        }

        function bulkDelete() {
            const selectedIds = getSelectedEmployees();
            if (selectedIds.length === 0) {
                showToast('请先选择员工', 'error');
                return;
            }
            
            if (confirm(`确定要删除选中的 ${selectedIds.length} 名员工吗？此操作不可恢复！`)) {
                employees = employees.filter(emp => !selectedIds.includes(emp.id));
                filteredEmployees = [...employees];
                updateEmployeesByOrganization();
                
                // 检查当前页是否还有数据
                const totalPages = Math.ceil(filteredEmployees.length / pageSize);
                if (currentPage > totalPages && totalPages > 0) {
                    currentPage = totalPages;
                }
                
                renderEmployeeTable();
                updateStats();
                hideBulkModal();
                showToast(`已删除 ${selectedIds.length} 名员工`, 'success');
            }
        }

        function bulkChangeStatus() {
            const selectedIds = getSelectedEmployees();
            if (selectedIds.length === 0) {
                showToast('请先选择员工', 'error');
                return;
            }
            
            const newStatus = confirm('点击"确定"设置为在岗，点击"取消"设置为不在岗') ? '有' : '无';
            let updatedCount = 0;
            
            selectedIds.forEach(id => {
                const empIndex = employees.findIndex(emp => emp.id === id);
                if (empIndex !== -1) {
                    // 检查身份限制
                    if ((employees[empIndex].role === '协管' || employees[empIndex].role === '实习') && newStatus === '无') {
                        // 协管和实习不能设置为不在岗，跳过
                        return;
                    }
                    employees[empIndex].onDuty = newStatus;
                    updatedCount++;
                }
            });
            
            updateEmployeesByOrganization();
            renderEmployeeTable();
            updateStats();
            hideBulkModal();
            showToast(`已更新 ${updatedCount} 名员工的在岗状态`, 'success');
        }

        function bulkExport() {
            const selectedIds = getSelectedEmployees();
            if (selectedIds.length === 0) {
                showToast('请先选择员工', 'error');
                return;
            }
            
            const selectedEmployees = employees.filter(emp => selectedIds.includes(emp.id));
            exportEmployeesToCSV(selectedEmployees, '选中员工信息');
            hideBulkModal();
        }

        function addDutyRecord() {
            const selectedIds = getSelectedEmployees();
            if (selectedIds.length === 0) {
                showToast('请先选择员工', 'error');
                return;
            }
            
            const date = prompt('请输入值班日期 (格式: YYYY-MM-DD):');
            if (date && /^\d{4}-\d{2}-\d{2}$/.test(date)) {
                selectedIds.forEach(id => {
                    const empIndex = employees.findIndex(emp => emp.id === id);
                    if (empIndex !== -1) {
                        if (!employees[empIndex].dutyHistory) {
                            employees[empIndex].dutyHistory = [];
                        }
                        employees[empIndex].dutyHistory.push(date);
                        employees[empIndex].dutyHistory.sort();
                        employees[empIndex].dutyHours = calculateDutyHours(employees[empIndex].dutyHistory);
                    }
                });
                
                updateEmployeesByOrganization();
                renderEmployeeTable();
                updateStats();
                hideBulkModal();
                showToast(`已为 ${selectedIds.length} 名员工添加值班记录`, 'success');
            } else if (date) {
                showToast('日期格式不正确，请使用 YYYY-MM-DD 格式', 'error');
            }
        }

        function toggleSelectAll() {
            if (!currentUser || currentUser.userType !== 'admin') return;
            
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.employee-checkbox');
            checkboxes.forEach(cb => cb.checked = selectAll.checked);
            updateSelectedCount();
        }

        /*********************
         * 数据导出功能
         *********************/
        
        function exportToCSV() {
            exportEmployeesToCSV(filteredEmployees, '员工信息');
        }

        function exportEmployeesToCSV(employeeData, filename) {
            const headers = ['姓名', '工号', '性别', '年龄', '单位', '身份', '在岗情况', '值班时间', '证书', '学历', '薪资', '入职日期', '电话', '邮箱', '备注'];
            const csvData = employeeData.map(emp => [
                emp.name, 
                emp.employeeId, 
                emp.gender, 
                emp.age, 
                emp.unit, 
                emp.role, 
                emp.onDuty, 
                emp.dutyHours || 0, 
                emp.certificates ? emp.certificates.join(';') : '',
                emp.education,
                emp.salary || 0,
                emp.hireDate || '',
                emp.phone || '',
                emp.email || '',
                emp.remark || ''
            ]);
            
            const csvContent = [headers, ...csvData]
                .map(row => row.map(field => {
                    const value = String(field || '');
                    // 处理包含逗号、引号或换行符的字段
                    if (value.includes(',') || value.includes('"') || value.includes('\n')) {
                        return `"${value.replace(/"/g, '""')}"`;
                    }
                    return value;
                }).join(','))
                .join('\n');
            
            // 添加BOM以支持中文
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, 19);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `${filename}_${timestamp}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            URL.revokeObjectURL(url);
            showToast('数据导出成功！', 'success');
        }

        /*********************
         * 值班日历功能
         *********************/
        
        function showDutySchedule() {
            const calendarSection = document.getElementById('calendarSection');
            calendarSection.classList.remove('hidden');
            
            // 如果日历尚未初始化，则进行初始化
            if (!calendar) {
                initializeCalendar();
            }
            
            // 滚动到日历区域
            calendarSection.scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }

        function hideCalendar() {
            document.getElementById('calendarSection').classList.add('hidden');
        }

        function initializeCalendar() {
            const calendarEl = document.getElementById('calendar');
            
            // 将员工的值班历史转换为日历事件
            const events = employees.flatMap(emp => 
                (emp.dutyHistory || []).map(date => ({
                    title: `${emp.name} (${emp.role})`,
                    start: date,
                    allDay: true,
                    backgroundColor: emp.role === '值班长' ? '#ef4444' : '#3b82f6',
                    borderColor: emp.role === '值班长' ? '#dc2626' : '#2563eb',
                    extendedProps: {
                        employeeId: emp.id,
                        employeeName: emp.name,
                        role: emp.role,
                        unit: emp.unit
                    }
                }))
            );
            
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                height: 'auto',
                locale: 'zh-cn',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,listWeek'
                },
                buttonText: {
                    today: '今天',
                    month: '月',
                    week: '周',
                    list: '列表'
                },
                editable: currentUser && currentUser.userType === 'admin',
                selectable: currentUser && currentUser.userType === 'admin',
                selectMirror: true,
                events: events,
                
                // 日期点击事件
                dateClick: function(info) {
                    if (currentUser && currentUser.userType === 'admin') {
                        const employeeName = prompt('请输入值班员工姓名:');
                        if (employeeName) {
                            const employee = employees.find(emp => emp.name === employeeName);
                            if (employee) {
                                // 添加值班记录
                                if (!employee.dutyHistory) {
                                    employee.dutyHistory = [];
                                }
                                if (!employee.dutyHistory.includes(info.dateStr)) {
                                    employee.dutyHistory.push(info.dateStr);
                                    employee.dutyHistory.sort();
                                    employee.dutyHours = calculateDutyHours(employee.dutyHistory);
                                    
                                    // 添加到日历
                                    calendar.addEvent({
                                        title: `${employee.name} (${employee.role})`,
                                        start: info.dateStr,
                                        allDay: true,
                                        backgroundColor: employee.role === '值班长' ? '#ef4444' : '#3b82f6',
                                        borderColor: employee.role === '值班长' ? '#dc2626' : '#2563eb'
                                    });
                                    
                                    updateEmployeesByOrganization();
                                    renderEmployeeTable();
                                    updateStats();
                                    showToast('值班安排添加成功！', 'success');
                                } else {
                                    showToast('该员工在此日期已有值班安排', 'error');
                                }
                            } else {
                                showToast('未找到该员工', 'error');
                            }
                        }
                    }
                },
                
                // 事件点击
                eventClick: function(info) {
                    const props = info.event.extendedProps;
                    if (confirm(`${props.employeeName} (${props.role})\n${props.unit}\n\n是否删除此值班安排？`)) {
                        if (currentUser && currentUser.userType === 'admin') {
                            const employee = employees.find(emp => emp.id === props.employeeId);
                            if (employee && employee.dutyHistory) {
                                const dateIndex = employee.dutyHistory.indexOf(info.event.startStr);
                                if (dateIndex > -1) {
                                    employee.dutyHistory.splice(dateIndex, 1);
                                    employee.dutyHours = calculateDutyHours(employee.dutyHistory);
                                    info.event.remove();
                                    
                                    updateEmployeesByOrganization();
                                    renderEmployeeTable();
                                    updateStats();
                                    showToast('值班安排删除成功！', 'success');
                                }
                            }
                        }
                    }
                },
                
                // 事件拖拽
                eventDrop: function(info) {
                    if (currentUser && currentUser.userType === 'admin') {
                        const props = info.event.extendedProps;
                        const employee = employees.find(emp => emp.id === props.employeeId);
                        if (employee && employee.dutyHistory) {
                            const oldDate = info.oldEvent.startStr;
                            const newDate = info.event.startStr;
                            
                            const dateIndex = employee.dutyHistory.indexOf(oldDate);
                            if (dateIndex > -1) {
                                employee.dutyHistory[dateIndex] = newDate;
                                employee.dutyHistory.sort();
                                
                                updateEmployeesByOrganization();
                                renderEmployeeTable();
                                showToast('值班安排更新成功！', 'success');
                            }
                        }
                    }
                }
            });
            
            calendar.render();
        }

        /*********************
         * 值班分析功能
         *********************/
        
        function showDutyAnalysis() {
            generateDutyAnalysis();
            document.getElementById('analysisModal').classList.add('show');
        }

        function hideAnalysisModal() {
            document.getElementById('analysisModal').classList.remove('show');
        }

        function generateDutyAnalysis() {
            const totalEmployees = employees.length;
            const onDutyEmployees = employees.filter(emp => emp.onDuty === '有');
            const totalDutyHours = employees.reduce((sum, emp) => sum + (emp.dutyHours || 0), 0);
            const avgDutyHours = totalEmployees > 0 ? Math.round((totalDutyHours / totalEmployees) * 10) / 10 : 0;

            // 按单位统计
            const unitStats = {};
            employees.forEach(emp => {
                if (!unitStats[emp.unit]) {
                    unitStats[emp.unit] = {
                        total: 0,
                        onDuty: 0,
                        dutyHours: 0,
                        supervisors: 0
                    };
                }
                unitStats[emp.unit].total++;
                if (emp.onDuty === '有') unitStats[emp.unit].onDuty++;
                if (emp.role === '值班长') unitStats[emp.unit].supervisors++;
                unitStats[emp.unit].dutyHours += emp.dutyHours || 0;
            });

            // 按身份统计
            const roleStats = {};
            employees.forEach(emp => {
                if (!roleStats[emp.role]) {
                    roleStats[emp.role] = { count: 0, dutyHours: 0 };
                }
                roleStats[emp.role].count++;
                roleStats[emp.role].dutyHours += emp.dutyHours || 0;
            });

            // 证书持有情况
            const certStats = {};
            employees.forEach(emp => {
                if (emp.certificates && emp.certificates.length > 0) {
                    emp.certificates.forEach(cert => {
                        certStats[cert] = (certStats[cert] || 0) + 1;
                    });
                }
            });

            // 值班时长分析
            const dutyRanges = {
                high: employees.filter(emp => (emp.dutyHours || 0) > 80).length,
                medium: employees.filter(emp => {
                    const hours = emp.dutyHours || 0;
                    return hours >= 40 && hours <= 80;
                }).length,
                low: employees.filter(emp => (emp.dutyHours || 0) < 40).length
            };

            const analysisContent = `
                <div class="space-y-8">
                    <!-- 总体统计 -->
                    <div>
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">总体统计</h4>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <svg class="h-8 w-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                        </svg>
                                    </div>
                                    <div class="ml-4">
                                        <h4 class="font-semibold text-blue-800">总人数</h4>
                                        <p class="text-3xl font-bold text-blue-600">${totalEmployees}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-green-50 p-6 rounded-lg border border-green-200">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <svg class="h-8 w-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    <div class="ml-4">
                                        <h4 class="font-semibold text-green-800">在岗人员</h4>
                                        <p class="text-3xl font-bold text-green-600">${onDutyEmployees.length}</p>
                                        <p class="text-sm text-green-600">${totalEmployees > 0 ? Math.round((onDutyEmployees.length / totalEmployees) * 100) : 0}%</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-purple-50 p-6 rounded-lg border border-purple-200">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <svg class="h-8 w-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    <div class="ml-4">
                                        <h4 class="font-semibold text-purple-800">总值班时间</h4>
                                        <p class="text-3xl font-bold text-purple-600">${totalDutyHours}</p>
                                        <p class="text-sm text-purple-600">小时</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-orange-50 p-6 rounded-lg border border-orange-200">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <svg class="h-8 w-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                        </svg>
                                    </div>
                                    <div class="ml-4">
                                        <h4 class="font-semibold text-orange-800">人均值班</h4>
                                        <p class="text-3xl font-bold text-orange-600">${avgDutyHours}</p>
                                        <p class="text-sm text-orange-600">小时/人</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- 各单位统计 -->
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">各单位统计</h4>
                            <div class="bg-white border rounded-lg overflow-hidden">
                                <div class="max-h-80 overflow-y-auto">
                                    ${Object.entries(unitStats).map(([unit, stats]) => `
                                        <div class="p-4 border-b last:border-b-0 hover:bg-gray-50 transition-colors">
                                            <div class="flex justify-between items-start mb-2">
                                                <h5 class="font-medium text-gray-900 text-sm">${unit}</h5>
                                                <span class="text-xs text-gray-500">${Math.round((stats.onDuty / stats.total) * 100)}% 在岗</span>
                                            </div>
                                            <div class="grid grid-cols-4 gap-2 text-xs text-gray-600 mb-2">
                                                <div>总数: ${stats.total}</div>
                                                <div>在岗: ${stats.onDuty}</div>
                                                <div>值班长: ${stats.supervisors}</div>
                                                <div>值班: ${stats.dutyHours}h</div>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div class="bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: ${(stats.onDuty / stats.total) * 100}%"></div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>

                        <!-- 身份分布 -->
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">身份分布与效率</h4>
                            <div class="space-y-3">
                                ${Object.entries(roleStats).map(([role, stats]) => {
                                    const avgHours = stats.count > 0 ? Math.round((stats.dutyHours / stats.count) * 10) / 10 : 0;
                                    const colorClass = role === '值班长' ? 'bg-red-50 border-red-200' : 
                                                     role === '值班员' ? 'bg-blue-50 border-blue-200' :
                                                     role === '协管' ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200';
                                    return `
                                        <div class="p-4 ${colorClass} border rounded-lg">
                                            <div class="flex justify-between items-center mb-2">
                                                <span class="font-medium text-gray-900">${role}</span>
                                                <span class="text-sm text-gray-600">${stats.count}人</span>
                                            </div>
                                            <div class="flex justify-between text-sm text-gray-600">
                                                <span>总值班: ${stats.dutyHours}小时</span>
                                                <span>人均: ${avgHours}小时</span>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- 证书统计 -->
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">证书持有情况</h4>
                            <div class="bg-white border rounded-lg p-4">
                                <div class="grid grid-cols-2 gap-3">
                                    ${Object.entries(certStats).map(([cert, count]) => `
                                        <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                                            <span class="text-sm font-medium text-gray-900">${cert}</span>
                                            <span class="text-lg font-bold text-blue-600">${count}</span>
                                        </div>
                                    `).join('')}
                                </div>
                                ${Object.keys(certStats).length === 0 ? 
                                    '<div class="text-center text-gray-500 py-4">暂无证书数据</div>' : 
                                    ''
                                }
                            </div>
                        </div>

                        <!-- 值班效率分析 -->
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">值班效率分析</h4>
                            <div class="space-y-4">
                                <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h5 class="font-medium text-green-800">高效员工 (>80小时)</h5>
                                            <p class="text-sm text-green-600">表现优秀，值班时间充足</p>
                                        </div>
                                        <div class="text-3xl font-bold text-green-600">${dutyRanges.high}</div>
                                    </div>
                                </div>
                                <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h5 class="font-medium text-yellow-800">中等员工 (40-80小时)</h5>
                                            <p class="text-sm text-yellow-600">值班时间适中，有提升空间</p>
                                        </div>
                                        <div class="text-3xl font-bold text-yellow-600">${dutyRanges.medium}</div>
                                    </div>
                                </div>
                                <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h5 class="font-medium text-red-800">待提升员工 (<40小时)</h5>
                                            <p class="text-sm text-red-600">需要增加值班安排</p>
                                        </div>
                                        <div class="text-3xl font-bold text-red-600">${dutyRanges.low}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 管理建议 -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 p-6 rounded-lg">
                        <h4 class="text-lg font-semibold text-blue-900 mb-4 flex items-center">
                            <svg class="h-5 w-5 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                            </svg>
                            管理建议与优化方向
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="space-y-3">
                                <div class="flex items-start space-x-3">
                                    <div class="w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"></div>
                                    <div>
                                        <h5 class="font-medium text-blue-900">在岗率分析</h5>
                                        <p class="text-sm text-blue-800">
                                            当前在岗率: ${totalEmployees > 0 ? Math.round((onDutyEmployees.length / totalEmployees) * 100) : 0}%
                                            ${onDutyEmployees.length < totalEmployees * 0.8 ? '，建议关注人员调配' : '，人员配置良好'}
                                        </p>
                                    </div>
                                </div>
                                <div class="flex items-start space-x-3">
                                    <div class="w-2 h-2 bg-green-500 rounded-full mt-2 flex-shrink-0"></div>
                                    <div>
                                        <h5 class="font-medium text-blue-900">值班强度</h5>
                                        <p class="text-sm text-blue-800">
                                            人均值班时间: ${avgDutyHours}小时
                                            ${avgDutyHours < 60 ? '，可适当增加值班安排' : avgDutyHours > 100 ? '，注意合理安排休息' : '，值班强度适中'}
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-3">
                                <div class="flex items-start space-x-3">
                                    <div class="w-2 h-2 bg-purple-500 rounded-full mt-2 flex-shrink-0"></div>
                                    <div>
                                        <h5 class="font-medium text-blue-900">专业资质</h5>
                                        <p class="text-sm text-blue-800">
                                            证书覆盖: 共${Object.keys(certStats).length}种证书
                                            ${Object.keys(certStats).length < 4 ? '，建议加强人员培训' : '，专业资质良好'}
                                        </p>
                                    </div>
                                </div>
                                <div class="flex items-start space-x-3">
                                    <div class="w-2 h-2 bg-orange-500 rounded-full mt-2 flex-shrink-0"></div>
                                    <div>
                                        <h5 class="font-medium text-blue-900">改进建议</h5>
                                        <p class="text-sm text-blue-800">
                                            重点关注值班时间较少的员工，加强培训和轮岗安排，优化资源配置
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('analysisContent').innerHTML = analysisContent;
        }

        /*********************
         * 重置数据功能
         *********************/
        
        function resetToDefaultData() {
            if (!currentUser || currentUser.userType !== 'admin') {
                showToast('没有权限执行此操作！', 'error');
                return;
            }
            
            if (confirm('确定要重置所有数据为初始状态吗？这将清除所有修改！')) {
                showLoading();
                
                setTimeout(() => {
                    // 重新加载默认数据
                    loadEmployeeData();
                    hideLoading();
                    showToast('数据已重置为初始状态！', 'success');
                }, 1000);
            }
        }

        /*********************
         * 键盘导航支持
         *********************/
        
        // 添加键盘事件监听
        document.addEventListener('keydown', function(e) {
            // ESC键关闭模态框
            if (e.key === 'Escape') {
                const openModals = document.querySelectorAll('.modal.show');
                if (openModals.length > 0) {
                    openModals.forEach(modal => modal.classList.remove('show'));
                }
                // 隐藏日历
                if (!document.getElementById('calendarSection').classList.contains('hidden')) {
                    hideCalendar();
                }
            }
            
            // Ctrl+F 聚焦搜索框
            if (e.ctrlKey && e.key === 'f') {
                e.preventDefault();
                const searchInput = document.getElementById('searchInput');
                if (searchInput && currentUser) {
                    searchInput.focus();
                }
            }
        });

        /*********************
         * 事件监听器初始化
         *********************/
        
        function initEventListeners() {
            const filterElements = [
                'searchInput', 'unitFilter', 'roleFilter', 'onDutyFilter', 
                'dutyTimeFilter', 'certificateFilter', 'educationFilter'
            ];
            
            filterElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    const eventType = element.tagName === 'INPUT' ? 'input' : 'change';
                    element.addEventListener(eventType, debouncedFilter);
                }
            });

            // 监听复选框变化
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('employee-checkbox')) {
                    updateSelectedCount();
                }
            });
            
            // 监听表单提交，防止页面刷新
            document.addEventListener('submit', function(e) {
                if (e.target.id !== 'loginForm' && e.target.id !== 'registerForm') {
                    e.preventDefault();
                }
            });
        }

        /*********************
         * 页面加载完成后初始化
         *********************/
        
        document.addEventListener('DOMContentLoaded', function() {
            initEventListeners();
            showPage('loginPage');
            
            // 显示欢迎信息
            setTimeout(() => {
                showToast('欢迎使用海事局VTS值班人事管理系统', 'info');
            }, 1000);
        });

        // 页面可见性变化处理
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'visible' && currentUser) {
                // 页面重新可见时刷新数据
                updateStats();
            }
        });
    </script>
</body>
</html>
